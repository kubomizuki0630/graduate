<div class="top-image"></div>

<div class="latestposts display-5 text-center mt-5 mb-5">みんなの作品</div>
<%= form_tag({controller:"/posts",action:"index"}, method: :get ,class:"d-flex search_form_container") do %>
  <%= text_field_tag :search  ,"",class:"form-control me-2 search_width" ,placeholder:"学生名・作品名" %>
  <%= submit_tag 'search' ,class:"btn btn-outline-success" %>
<% end %>
<div class="card-container">
  <% @posts.each do |t| %>
    <% if user_signed_in? %>
      <% if current_user.already_liked?(id: t.id, post_id: t.id) %>
        <div class="card mb-5 red-border" style="width: 18rem;">
      <% else %>
        <div class="card mb-5" style="width: 18rem;">
      <% end %>
    <% else %>
        <div class="card mb-5" style="width: 18rem;">
    <% end %>
          <div class="card-header card-title"><%= t.user.name %></div>
        <%= link_to(post_path(t.id),class:'text-decoration-none text-success') do %>
          <% if t.images.exists? && t.images[0]  %>
              <%= image_tag t.images[0], class: "card-img-top" %>
          <% else %>
            <%= image_tag "noimage.png",class: "card-img-top"  %>
          <% end %>
        <% end %>
        <div class="card-body">
        <%= link_to(post_path(t.id),class:'text-decoration-none text-success') do %>
          <div class="card-title ellipsis"><%= t.title %></div>
        <% end %>
        <div class="d-flex justify-content-between align-items-center card-body-footer">
          <div class="btn-group">
            <%= link_to "detail", post_path(t.id) ,class: "btn btn-sm btn-outline-secondary" %>
            <% if user_signed_in? %>
              <% if current_user.id == t.user_id %>
                <%= link_to "edit", edit_post_path(t.id) ,class: "btn btn-sm btn-outline-secondary" %>
                <%= button_to "delete", post_path(t.id), method: :delete ,data: {confirm: "Do you want to delete it?"},class: "btn btn-sm btn-outline-secondary" %>
              <% else %>
                <% if current_user.already_liked?(id: t.id, post_id: t.id) %>
                  <%= button_to post_like_path(id: t.id, post_id: t.id), class: "btn btn-link" , method: :delete do %>
                    <i class="fa-solid fa-thumbs-up unlike-btn"></i>
                  <% end %>
                <% else %>
                  <%= button_to post_likes_path(id: t.id, post_id: t.id), class: "btn btn-link" ,method: :post do %>
                    <i class="fa-regular fa-thumbs-up like-btn"></i>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <% if (@now - t.created_at) <= 60 * 60 %>
            <small class="text-muted"><%=((@now - t.created_at) / 60).to_i.to_s + "分前" %></small>
          <% elsif (@now - t.created_at) <= 60 * 60 * 24 %>
            <small class="text-muted"><%=((@now - t.created_at) / 3600).to_i.to_s + "時間前" %></small>
          <% elsif (@today - t.created_at.to_date) <= 30 %>
            <small class="text-muted"><%= (@today - t.created_at.to_date).to_i.to_s + "日前" %></small>
          <% else %>
            <small class="text-muted"><%= t.created_at.strftime('%Y-%m-%d') %></small>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<%= paginate @posts %>


  <% if user_signed_in? %>
    <% unless current_user.email.include?('@design.kyushu-u.ac.jp') %>
      <%= link_to(new_post_path) do %>
        <i class="fa-solid fa-circle-plus fa-4x text-success"></i>
        <% end %>
        <br><br><br>
    <% end %>
  <% end %>