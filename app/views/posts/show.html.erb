<div class="container_pt">
  <h3 class="title_mb">
    <%= @post.title %>
    <% if user_signed_in? %>
      <% if current_user.id == @post.user_id %>
        <%= link_to  edit_post_path(@post.id) do %>
          <i class="fa-solid fa-pen-to-square edit_link"></i>
        <% end %>
      <% end %>
    <% end %>
  </h3>
  <% if @post.images.exists? && @post.images[0] %>
    <% @post.images.each do |image| %>
      <%= image_tag image , class: "show-image" %>
    <% end %>
  <% end %>
</div>
<br><br><br>
<% unless (@post.youtube_url==nil) || (@post.youtube_url=="") %>
<iframe class="embedded_link"  src="https://www.youtube.com/embed/<%= @post.youtube_url %>" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<% end %>

<% if @post.skechfab? %>
<iframe class="embedded_link" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/<%= @post.skechfab %>/embed"> </iframe> 
<% end %>
<div class="show-body">
<h3 class="fz-20">content</h3>
  <p><%= text_url_to_link(safe_join((h(@post.content)).split("\n"),tag(:br))).html_safe %></p>
</div>
  <% if (@now - @post.created_at) <= 60 * 60 %>
    <small class="text-muted"><%=((@now - @post.created_at) / 60).to_i.to_s + "分前" %></small>
  <% elsif (@now - @post.created_at) <= 60 * 60 * 24 %>
    <small class="text-muted"><%=((@now - @post.created_at) / 3600).to_i.to_s + "時間前" %></small>
  <% elsif (@today - @post.created_at.to_date) <= 30 %>
    <small class="text-muted"><%= (@today - @post.created_at.to_date).to_i.to_s + "日前" %></small>
  <% else %>
    <small class="text-muted"><%= @post.created_at.strftime('%Y-%m-%d') %></small>
  <% end %>


  <br><br><br>
  <h1>ここから下は作業場所</h1>
  <% if user_signed_in? %>
  <% if current_user.already_liked?(@post) %>
    <%= button_to post_like_path(@post), method: :delete do %>
      得点候補解除
    <% end %>
    <%#= @post.likes.count %>
  <% else %>
    <%= button_to post_likes_path(@post), method: :post do %>
      得点候補
    <% end %>
    <%#= @post.likes.count %>
  <% end %>
<% else %>
  <%#= @post.likes.count %>
<% end %>

<br>
<div class="comment-wrapper">
  <h3>comments</h3>
  <% @comments.each do |c| %>
    <div>
      <% if c.point?%>
        <%= c.user.email unless c.user.blank? %>：<%= c.point %>点
        <br>
        <%= c.content %>
      <% else %>
        <%= c.user.email unless c.user.blank? %>：
        <br>
        <%= c.content %>
      <% end %>
    </div>
  <% end %>

  <% if user_signed_in? %>
    <%= form_with(model: [@post, @comment], local: true) do |f| %>
      <コメント><br>
      <%= f.text_area :content %><br><br>
    <%# if current_user.is_professor? %>
      <点数><br>
      <p>※半角数字のみ入力</p>
      <p>※0点は記入する必要ありません</p>
      <%= f.number_field :point ,step: "0.1" %> 点<br><br>
    <%# end %>
      <%= button_tag type: "submit" do %>
        <i class="far fa-comments"></i> 送信
      <% end %>
    <% end %>
  <% end %>
</div>
</div>